"use strict";var App=App||{},google=google;App.init=function(){this.apiUrl="http://localhost:3000/api",this.$main=$("main"),$(".home").on("click",this.homepage.bind(this)),$(".register").on("click",this.register.bind(this)),$(".login").on("click",this.login.bind(this)),$(".logout").on("click",this.logout.bind(this)),$(".map").on("click",this.createMap.bind(this)),this.$main.on("submit","form",this.handleForm),this.getToken()?this.loggedInState():this.loggedOutState()},App.homepage=function(){this.$main.html('\n    <h1 class="animated infinite bounce">RIOT</h1>\n    <p>Riot is a web application for festival listings around the globe and daily weather updates.<p>\n    <p>Created with &hearts; at GA by Remyce</p>\n    '),console.log("You clicked")},App.createMap=function(){var e=document.getElementById("canvas"),n={zoom:3,center:new google.maps.LatLng(53.481878,(-2.263164)),styles:[{featureType:"administrative",elementType:"all",stylers:[{color:"#054c78"},{weight:"0.01"}]},{featureType:"administrative.country",elementType:"all",stylers:[{color:"#054c78"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#fefaed"}]},{featureType:"poi",elementType:"all",stylers:[{color:"#fefaed"}]},{featureType:"road",elementType:"all",stylers:[{color:"#fefaed"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#bad8ea"},{visibility:"on"}]}],zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER},mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(e,n),this.getFestivals()},App.getFestivals=function(){return $.get(this.apiUrl+"/festivals").done(this.loopThroughFestivals.bind(this))},App.loopThroughFestivals=function(e){return console.log(e.festivals.length,"festivals"),$.each(e.festivals,this.createMarkerForFestival)},App.createMarkerForFestival=function(e,n){var t=new google.maps.LatLng(n.lat,n.lng);console.log(n.lat,n.lng);var o={url:"/images/marker.png",scaledSize:new google.maps.Size(30,45)},a=new google.maps.Marker({position:t,map:App.map,animation:google.maps.Animation.DROP,icon:o});App.addInfoWindowForFestival(n,a)},App.addInfoWindowForFestival=function(e,n){var t=this;google.maps.event.addListener(n,"click",function(){"undefined"!=typeof t.infoWindow&&t.infoWindow.close(n,"click"),App.ajaxRequest("http://localhost:3000/api/weather","POST",e,function(o){console.log(o),t.infoWindow=new google.maps.InfoWindow({maxWidth:200,content:'\n        <div class="infoWindow">\n        <h2 style="color:#F26521;">'+e.name+"</h2>\n        <h6>"+e.location+'</h6>\n        <h6 style="color:#E1BB32;">'+e.date+"</h6>\n        <p>"+e.description+"</p>\n        <p>Genre: "+e.genre+"</p>\n        <p>"+e.website+'</p>\n        <div class="weather">\n        <h6>Weather</h6>\n        <div class="summary">\n        <p>'+o.weather+'</p>\n        </div>\n        <div class="weatherXIcon">\n        <p>'+o.icon+'</p>\n        </div>\n        <div class="weatherIcon">\n        <img src="'+App.getIcon(o.icon)+'">\n        </div>\n        <div class="weatherTemperature">\n        <p>'+o.temperature+"Â°F</p>\n        </div>\n        </div>\n        </div>\n        "}),t.infoWindow.open(t.map,n),t.map.setCenter(n.getPosition())})})},App.getIcon=function(e){var n;switch(e){case"rain":n="../images/rain.png";break;case"clear-day":n="../images/clear-day.png";break;case"clear-night":n="../images/clear-night.png";break;case"partly-cloudy-day":n="../images/partly-cloudy-day.png";break;case"partly-cloudy-night":n="../images/partly-cloudy-night";break;case"cloudy":n="../images/cloudy.png";break;case"sleet":n="../images/sleet.png";break;case"snow":n="../images/snow.png";break;case"wind":n="../images/wind.png";break;case"fog":n="../images/fog.png";break;default:n="../images/cloudy.png"}return n},App.loggedInState=function(){$(".loggedIn").show(),$(".map").show(),$(".loggedOut").hide(),this.$main.html('\n    <div id="canvas"></div>\n    '),this.createMap()},App.loggedOutState=function(){$(".loggedIn").hide(),$(".loggedOut").show(),this.homepage()},App.register=function(e){e&&e.preventDefault(),this.$main.html('\n          <h2>Register</h2>\n          <form method="post" action="/register">\n          <div class="form-group">\n          <input class="form-control" type="text" name="user[username]" placeholder="Username">\n          </div>\n          <div class="form-group">\n          <input class="form-control" type="email" name="user[email]" placeholder="Email">\n          </div>\n          <div class="form-group">\n          <input class="form-control" type="password" name="user[password]" placeholder="Password">\n          </div>\n          <div class="form-group">\n          <input class="form-control" type="password" name="user[passwordConfirmation]" placeholder="Password Confirmation">\n          </div>\n          <input class="btn btn-primary" type="submit" value="Register">\n          </form>\n          ')},App.login=function(e){e.preventDefault(),this.$main.html('\n            <h2>Login</h2>\n            <form method="post" action="/login">\n            <div class="form-group">\n            <input class="form-control" type="email" name="email" placeholder="Email">\n            </div>\n            <div class="form-group">\n            <input class="form-control" type="password" name="password" placeholder="Password">\n            </div>\n            <input class="btn btn-primary" type="submit" value="Login">\n            </form>\n            ')},App.logout=function(e){e.preventDefault(),this.removeToken(),this.loggedOutState()},App.handleForm=function(e){console.log(this),e.preventDefault();var n=""+App.apiUrl+$(this).attr("action"),t=$(this).attr("method"),o=$(this).serialize();return App.ajaxRequest(n,t,o,function(e){e.token&&App.setToken(e.token),App.loggedInState()})},App.ajaxRequest=function(e,n,t,o){return $.ajax({url:e,method:n,data:t,beforeSend:this.setRequestHeader.bind(this)}).done(o).fail(function(e){console.log(e)})},App.setRequestHeader=function(e){return e.setRequestHeader("Authorization","Be"+this.getToken())},App.setToken=function(e){return window.localStorage.setItem("token",e)},App.getToken=function(){return window.localStorage.getItem("token")},App.removeToken=function(){return window.localStorage.clear()},$(App.init.bind(App));